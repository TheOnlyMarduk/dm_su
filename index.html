<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<title>Laufstrecken mit Parkpl√§tzen und Infos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

<style>
  html, body { margin: 0; padding: 0; height: 100%; }
  #map { height: 100vh; width: 100vw; }

  .arrow-icon { font-size: 20px; display: flex; align-items: center; justify-content: center; width: 20px; height: 20px; pointer-events: none; }
  .arrow-symbol { display: inline-block; transform-origin: center; }

  .marker-label { 
    background: white; 
    border: 2px solid black; 
    border-radius: 50%; 
    text-align: center; 
    font-weight: bold; 
    color: black; 
    box-shadow: 0 0 3px rgba(0,0,0,0.5); 
    display: flex; 
    align-items: center; 
    justify-content: center; 
  }

  .km-label { 
    background: yellow; 
    border: 1px solid black; 
    border-radius: 3px; 
    padding: 2px 5px; 
    font-weight: bold; 
    font-size: 12px; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    white-space: nowrap; 
  }

  /* Parkplatz Icon: wei√ües P auf blauem Kreis */
  .parking-icon {
    background-color: blue;
    color: white;
    border-radius: 50%;
    border: 2px solid white;
    font-weight: bold;
    text-align: center;
    line-height: 1;
    user-select: none;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 3px rgba(0,0,0,0.7);
  }

  /* √ñPNV Icon: wei√ües H auf rotem Kreis */
  .oepnv-icon {
    background-color: red;
    color: white;
    border-radius: 50%;
    border: 2px solid white;
    font-weight: bold;
    text-align: center;
    line-height: 1;
    user-select: none;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 3px rgba(0,0,0,0.7);
  }

  /* Laufinfos: einfache Symbole mit Farben */
  .info-icon {
    background-color: white;
    color: black;
    border-radius: 3px;
    border: 1px solid black;
    font-weight: bold;
    text-align: center;
    user-select: none;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2px 4px;
    box-shadow: 0 0 2px rgba(0,0,0,0.5);
    font-size: 14px;
  }

</style>
</head>
<body>
<div id="map"></div>

<script>
const map = L.map('map');

// OpenStreetMap-Kachel-Layer
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap' }).addTo(map);

// Layer-Gruppen f√ºr L√§ufe (wie gehabt)
const layer10km = L.layerGroup();
const layer5km = L.layerGroup();
const layerSchuelerlauf = L.layerGroup();
const layerKinderlauf = L.layerGroup();
const layerBambinilauf = L.layerGroup();

// Neue Layer f√ºr Parkpl√§tze, √ñPNV und Laufinfos
const parkingLayer = L.layerGroup();
const oepnvLayer = L.layerGroup();
const infosLayer = L.layerGroup();

// Gruppierter Layer f√ºr alle Parkpl√§tze, √ñPNV, Infos
const infosGroup = L.layerGroup([parkingLayer, oepnvLayer, infosLayer]);

// Funktion f√ºr skalierte Marker-Beschriftungen abh√§ngig vom Zoomlevel
function createScaledDivIcon(htmlContent, baseSize, className) {
  const zoom = map.getZoom();
  // Skalierung zwischen 0.6 und 1 je nach Zoom 12-18
  const scale = Math.min(1, Math.max(0.6, (zoom - 12) / 6));
  const size = baseSize * scale;
  return L.divIcon({
    className: className,
    html: htmlContent,
    iconSize: [size, size],
    iconAnchor: [size/2, size/2]
  });
}

// Beispiel Funktion f√ºr Parkpl√§tze-Icon "P" wei√ü auf blau
function createParkingIcon() {
  return createScaledDivIcon('<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;">P</div>', 30, 'parking-icon');
}

// Beispiel Funktion f√ºr √ñPNV-Icon "H" wei√ü auf rot
function createOepnvIcon() {
  return createScaledDivIcon('<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;">H</div>', 30, 'oepnv-icon');
}

// Funktion f√ºr Laufinformationen-Icons je nach Typ
function createInfoIcon(typ) {
  let symbol = '';
  switch(typ) {
    case 'Dusche': symbol = 'üöø'; break;
    case 'Startunterlagen': symbol = 'üìã'; break;
    case 'Toilette': symbol = 'üöª'; break;
    default: symbol = '?';
  }
  return createScaledDivIcon(symbol, 25, 'info-icon');
}

// Funktion zum Laden und Anzeigen von GeoJSON mit Symbolen und Tooltip aus info-Spalte
function loadGeoJsonWithIcons(url, layerGroup, iconFunction) {
  fetch(url)
    .then(res => res.json())
    .then(data => {
      data.features.forEach(feature => {
        if (!feature.geometry || feature.geometry.type !== 'Point') return;
        const coords = feature.geometry.coordinates;
        const latlng = L.latLng(coords[1], coords[0]);
        const info = feature.properties.info || "";
        // Icon erstellen und Marker hinzuf√ºgen
        const marker = L.marker(latlng, { icon: iconFunction() }).addTo(layerGroup);
        marker.bindTooltip(info, { permanent: false, direction: 'top' });
        // Icon bei Zoom skalieren
        map.on('zoomend', () => {
          marker.setIcon(iconFunction());
        });
      });
      layerGroup.addTo(map);
    })
    .catch(err => console.error(`Fehler beim Laden von ${url}:`, err));
}

// Funktion speziell f√ºr Laufinfos mit Typ-abh√§ngigen Icons
function loadLaufinfos(url) {
  fetch(url)
    .then(res => res.json())
    .then(data => {
      data.features.forEach(feature => {
        if (!feature.geometry || feature.geometry.type !== 'Point') return;
        const coords = feature.geometry.coordinates;
        const latlng = L.latLng(coords[1], coords[0]);
        const info = feature.properties.info || "";
        const typ = feature.properties.typ || "";

        const marker = L.marker(latlng, { icon: createInfoIcon(typ) }).addTo(infosLayer);
        marker.bindTooltip(info, { permanent: false, direction: 'top' });
        map.on('zoomend', () => {
          marker.setIcon(createInfoIcon(typ));
        });
      });
      infosLayer.addTo(map);
    })
    .catch(err => console.error(`Fehler beim Laden von ${url}:`, err));
}

// Beispiel: Parkpl√§tze laden
loadGeoJsonWithIcons('parken.geojson', parkingLayer, createParkingIcon);

// √ñPNV laden
loadGeoJsonWithIcons('oepnv.geojson', oepnvLayer, createOepnvIcon);

// Laufinfos laden
loadLaufinfos('informationen.geojson');

// (Deine Laufstrecken-Layer etc. hier unver√§ndert, wie in deinem Code ...)

// Beispiel zum Hinzuf√ºgen eines Kontrolllayers, inkl. neuen Gruppenlayer f√ºr Infos:
const baseLayers = {
  "10 km DM und Citylauf (2 Runden)": layer10km,
  "5 km Citylauf": layer5km,
  "3,6 km KSK K√∂ln - Sch√ºlerlauf (U14/U16)": layerSchuelerlauf,
  "1,2 km KSK K√∂ln - Kinderlauf (U10/U12) (2 Runden)": layerKinderlauf,
  "0,6 km KSK K√∂ln - Bambinilauf (U8)": layerBambinilauf
};

const overlays = {
  "Parkpl√§tze": parkingLayer,
  "√ñPNV": oepnvLayer,
  "Laufinformationen": infosLayer,
  // Oder alle Infos zusammen als Gruppe:
  // "Alle Infos (Parkpl√§tze, √ñPNV, Laufinfos)": infosGroup
};

// Standardm√§√üig anzeigen:
layer10km.addTo(map);
parkingLayer.addTo(map);
oepnvLayer.addTo(map);
infosLayer.addTo(map);

// Layer-Kontrolle
L.control.layers(baseLayers, overlays, { collapsed: false }).addTo(map);

</script>
</body>
</html>
