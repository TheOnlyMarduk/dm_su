<script>
// ... dein bestehender Code ...

const parkingLayer = L.layerGroup();
const oepnvLayer = L.layerGroup(); // NEU: Layer für ÖPNV

// Parkplätze laden und darstellen
function loadAndDrawParking() {
  fetch('parken.geojson')
    .then(res => res.json())
    .then(data => {
      data.features.forEach(feature => {
        if (!feature.geometry || feature.geometry.type !== 'Point') return;
        const coords = feature.geometry.coordinates;
        const latlng = L.latLng(coords[1], coords[0]);
        const adresse = feature.properties.adresse || "Parkplatz";
        const parkIcon = () => L.divIcon({ 
          className: "start-goal-icon", 
          iconAnchor: [15,15], 
          html: createScaledMarkerLabel("P", 30) 
        });
        const marker = L.marker(latlng, { icon: parkIcon() }).addTo(parkingLayer);
        marker.bindTooltip(
          adresse.replace(/\n/g, '<br>'), 
          { permanent: false, direction: 'top', opacity: 0.9, sticky: true, interactive: true }
        );
        map.on('zoomend', () => marker.setIcon(parkIcon()));
      });
    })
    .catch(err => console.error("Fehler beim Laden der parken.geojson:", err));
}

// ÖPNV laden und darstellen (analog zu Parkplätzen)
function loadAndDrawOepnv() {
  fetch('oepnv.geojson')
    .then(res => res.json())
    .then(data => {
      data.features.forEach(feature => {
        if (!feature.geometry || feature.geometry.type !== 'Point') return;
        const coords = feature.geometry.coordinates;
        const latlng = L.latLng(coords[1], coords[0]);
        const info = feature.properties.info || "Haltestelle";
        const oepnvIcon = () => L.divIcon({ 
          className: "start-goal-icon", 
          iconAnchor: [15,15], 
          html: createScaledMarkerLabel("H", 30, "green") 
        });
        const marker = L.marker(latlng, { icon: oepnvIcon() }).addTo(oepnvLayer);
        marker.bindTooltip(
          info.replace(/\n/g, '<br>'), 
          { permanent: false, direction: 'top', opacity: 0.9, sticky: true, interactive: true }
        );
        map.on('zoomend', () => marker.setIcon(oepnvIcon()));
      });
    })
    .catch(err => console.error("Fehler beim Laden der oepnv.geojson:", err));
}

// Laden der Overlays
loadAndDrawParking();
loadAndDrawOepnv();

// Gruppierung: Hauptlayer "Informationen" → enthält Parkplätze + ÖPNV
const informationLayer = L.layerGroup([parkingLayer, oepnvLayer]);

// Basis-Layer (Radio)
const baseLayers = {
  "10 km DM und Citylauf (2 Runden)": layer10km,
  "5 km Citylauf": layer5km,
  "3,6 km KSK Köln - Schülerlauf (U14/U16)": layerSchuelerlauf,
  "1,2 km KSK Köln - Kinderlauf (U10/U12) (2 Runden)": layerKinderlauf,
  "0,6 km KSK Köln - Bambinilauf (U8)": layerBambinilauf
};

// Overlays (Checkboxen)
const overlays = {
  "Informationen": informationLayer,
  "Parkplätze": parkingLayer,
  "ÖPNV": oepnvLayer
};

// Standard: 10 km und "Informationen" anzeigen
layer10km.addTo(map);
informationLayer.addTo(map);

// Layer-Kontrolle
L.control.layers(baseLayers, overlays, { collapsed: false }).addTo(map);

</script>
